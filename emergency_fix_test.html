<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Button Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üö® Emergency Production Fix Test</h1>
        <p><strong>Issue:</strong> Cannot read properties of undefined (reading 'includes')</p>
        <p><strong>Fix:</strong> Added null checks and error handling to responsive button system</p>
        
        <div class="test-section">
            <h2>Configuration Access Test</h2>
            <div id="config-test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Device Detection Test</h2>
            <div id="device-test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Button Layout Test</h2>
            <div id="button-test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>Error Handling Test</h2>
            <div id="error-test-result"></div>
        </div>
    </div>

    <script>
        // Simulate the responsive configuration
        const RESPONSIVE_CONFIG = {
            buttons: {
                desktop: {
                    layout: 'horizontal',
                    width: 'auto',
                    minWidth: '180px',
                    flexWrap: 'wrap',
                    gap: '16px'
                },
                tablet: {
                    layout: 'horizontal-stacked',
                    width: 'auto',
                    flexWrap: 'wrap'
                },
                mobile: {
                    layout: 'vertical-centered',
                    width: '100%'
                },
                smallMobile: {
                    layout: 'vertical-full',
                    width: '100%'
                }
            }
        };

        // Test configuration access
        function testConfigAccess() {
            try {
                const safeConfig = RESPONSIVE_CONFIG || {};
                const buttonsConfig = safeConfig.buttons || {};
                const config = buttonsConfig.desktop;
                
                if (config && config.layout) {
                    document.getElementById('config-test-result').innerHTML = 
                        '<div class="status success">‚úÖ Configuration access successful</div>';
                    return true;
                } else {
                    document.getElementById('config-test-result').innerHTML = 
                        '<div class="status error">‚ùå Configuration missing</div>';
                    return false;
                }
            } catch (error) {
                document.getElementById('config-test-result').innerHTML = 
                    '<div class="status error">‚ùå Configuration access error: ' + error.message + '</div>';
                return false;
            }
        }

        // Test device detection
        function testDeviceDetection() {
            try {
                const detectDevice = () => {
                    const width = window.innerWidth;
                    if (width < 480) return 'smallMobile';
                    if (width < 768) return 'mobile';
                    if (width < 992) return 'tablet';
                    return 'desktop';
                };

                const device = detectDevice();
                document.getElementById('device-test-result').innerHTML = 
                    '<div class="status success">‚úÖ Device detected: ' + device + ' (width: ' + window.innerWidth + 'px)</div>';
                return true;
            } catch (error) {
                document.getElementById('device-test-result').innerHTML = 
                    '<div class="status error">‚ùå Device detection error: ' + error.message + '</div>';
                return false;
            }
        }

        // Test button layout configuration
        function testButtonLayout() {
            try {
                const getButtonConfig = (device) => {
                    const safeConfig = RESPONSIVE_CONFIG || {};
                    const buttonsConfig = safeConfig.buttons || {};
                    const config = buttonsConfig[device];
                    
                    if (!config) {
                        return {
                            containerStyle: { display: 'flex', flexDirection: 'row' },
                            buttonStyle: { width: 'auto', minWidth: '180px' }
                        };
                    }
                    
                    const layout = config.layout || 'horizontal';
                    
                    return {
                        containerStyle: {
                            display: 'flex',
                            flexDirection: layout === 'vertical-centered' || layout === 'vertical-full' ? 'column' : 'row',
                            flexWrap: config.flexWrap || 'wrap',
                            gap: config.gap || '16px',
                            justifyContent: layout.includes('centered') ? 'center' : 'flex-start',
                            alignItems: layout.includes('vertical') ? 'stretch' : 'center'
                        },
                        buttonStyle: {
                            width: config.width || 'auto',
                            minWidth: config.minWidth || '180px'
                        }
                    };
                };

                const desktopConfig = getButtonConfig('desktop');
                const mobileConfig = getButtonConfig('mobile');
                
                if (desktopConfig && mobileConfig) {
                    document.getElementById('button-test-result').innerHTML = 
                        '<div class="status success">‚úÖ Button layout configuration successful</div>' +
                        '<div class="status info">Desktop: ' + desktopConfig.containerStyle.flexDirection + '</div>' +
                        '<div class="status info">Mobile: ' + mobileConfig.containerStyle.flexDirection + '</div>';
                    return true;
                } else {
                    document.getElementById('button-test-result').innerHTML = 
                        '<div class="status error">‚ùå Button layout configuration failed</div>';
                    return false;
                }
            } catch (error) {
                document.getElementById('button-test-result').innerHTML = 
                    '<div class="status error">‚ùå Button layout error: ' + error.message + '</div>';
                return false;
            }
        }

        // Test error handling with undefined config
        function testErrorHandling() {
            try {
                // Test with undefined config
                const testUndefinedConfig = (device) => {
                    const safeConfig = undefined || {};
                    const buttonsConfig = safeConfig.buttons || {};
                    const config = buttonsConfig[device];
                    
                    if (!config) {
                        return { safe: true };
                    }
                    
                    const layout = config.layout || 'horizontal';
                    // This would cause the original error if layout is undefined
                    const centered = layout.includes('centered');
                    
                    return { safe: true, centered };
                };

                const result = testUndefinedConfig('nonexistent');
                
                if (result.safe) {
                    document.getElementById('error-test-result').innerHTML = 
                        '<div class="status success">‚úÖ Error handling works - undefined config handled safely</div>';
                    return true;
                } else {
                    document.getElementById('error-test-result').innerHTML = 
                        '<div class="status error">‚ùå Error handling failed</div>';
                    return false;
                }
            } catch (error) {
                document.getElementById('error-test-result').innerHTML = 
                    '<div class="status error">‚ùå Error handling test failed: ' + error.message + '</div>';
                return false;
            }
        }

        // Run all tests
        function runAllTests() {
            console.log('Running emergency fix tests...');
            
            const results = {
                config: testConfigAccess(),
                device: testDeviceDetection(),
                layout: testButtonLayout(),
                error: testErrorHandling()
            };
            
            const allPassed = Object.values(results).every(result => result === true);
            
            if (allPassed) {
                console.log('‚úÖ All tests passed - fix should work in production');
            } else {
                console.log('‚ùå Some tests failed - review needed');
            }
            
            return results;
        }

        // Run tests when page loads
        window.addEventListener('load', runAllTests);
        
        // Also run tests on resize to check responsive behavior
        window.addEventListener('resize', () => {
            setTimeout(runAllTests, 100);
        });
    </script>
</body>
</html>